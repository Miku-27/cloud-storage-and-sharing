import jwt
from datetime import datetime,timedelta,timezone

def _generate_access_token(JWT_SECRET:str,EXPIRE_TIME:int,JWT_ALGORITHMN:str,data:dict):
    now = datetime.now(timezone.utc)
    payload = {
        "sub":data["user_id"],
        "iat":int(now.timestamp()),
        "exp":int((now+timedelta(minutes=EXPIRE_TIME)).timestamp())
    }

    token = jwt.encode(payload,JWT_SECRET,JWT_ALGORITHMN)

    return token

def _validate_jwt(token,JWT_SECRET,JWT_ALOGO):
    try:
        payload = jwt.decode(
            token,
            JWT_SECRET,
            algorithms=[JWT_ALOGO],
        )
    

    user_id = payload.get("sub")
    if not user_id:
        raise ServiceException(ResultCodes.TOKEN_PAYLOAD_INVALID)
    
    return user_id